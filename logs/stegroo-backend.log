2025-08-27 21:38:59.386 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-08-27 21:38:59.407 [main] INFO  s.s.b.StegrooBackendApplication - Starting StegrooBackendApplication using Java 24.0.1 with PID 85957 (/Users/chappie/_AppProjects/stegroo/backend/target/classes started by chappie in /Users/chappie/_AppProjects/stegroo)
2025-08-27 21:38:59.407 [main] DEBUG s.s.b.StegrooBackendApplication - Running with Spring Boot v3.2.4, Spring v6.1.5
2025-08-27 21:38:59.407 [main] INFO  s.s.b.StegrooBackendApplication - The following 1 profile is active: "dev"
2025-08-27 21:38:59.773 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-08-27 21:38:59.799 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 6 JPA repository interfaces.
2025-08-27 21:39:00.198 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8081 (http)
2025-08-27 21:39:00.202 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8081"]
2025-08-27 21:39:00.203 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-08-27 21:39:00.203 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-08-27 21:39:00.232 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-08-27 21:39:00.232 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 808 ms
2025-08-27 21:39:00.308 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-08-27 21:39:00.379 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:stegroo user=SA
2025-08-27 21:39:00.380 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-08-27 21:39:00.384 [main] INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:stegroo'
2025-08-27 21:39:00.475 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-08-27 21:39:00.494 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-08-27 21:39:00.504 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-08-27 21:39:00.577 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-08-27 21:39:00.592 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-08-27 21:39:00.972 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-08-27 21:39:00.989 [main] DEBUG org.hibernate.SQL - 
    create table dead_letter_queue (
        id bigint generated by default as identity,
        created_at timestamp(6) not null,
        error_message varchar(2000) not null,
        error_type varchar(255),
        external_id varchar(255) not null,
        failure_reason varchar(500),
        job_data TEXT,
        max_retries integer not null,
        next_retry_at timestamp(6),
        retry_count integer not null,
        stack_trace TEXT,
        status varchar(255) not null check (status in ('PENDING','PROCESSING','SUCCESS','FAILED','EXPIRED')),
        sync_type varchar(255) not null check (sync_type in ('SNAPSHOT','INCREMENTAL','CATEGORIES','SKILLS','JOBS')),
        updated_at timestamp(6) not null,
        primary key (id)
    )
2025-08-27 21:39:00.993 [main] DEBUG org.hibernate.SQL - 
    create table job_categories (
        id bigint generated by default as identity,
        created_at timestamp(6),
        description varchar(1000),
        external_id varchar(255),
        hierarchy_level integer,
        hierarchy_path varchar(500),
        is_active boolean,
        last_sync_at timestamp(6),
        legacy_ams_taxonomy_id varchar(255),
        name varchar(255) not null,
        taxonomy_type varchar(255) check (taxonomy_type in ('OCCUPATION','SKILL','EMPLOYMENT_TYPE','WORKING_HOURS','LOCATION','INDUSTRY')),
        updated_at timestamp(6),
        parent_id bigint,
        primary key (id)
    )
2025-08-27 21:39:00.994 [main] DEBUG org.hibernate.SQL - 
    create table job_listings (
        id bigint generated by default as identity,
        company_name varchar(255),
        created_at timestamp(6),
        deadline timestamp(6),
        description varchar(10000),
        employment_type varchar(255),
        external_id varchar(255),
        external_url varchar(255),
        last_modified timestamp(6),
        location varchar(255),
        published_at timestamp(6),
        raw CLOB,
        removed_at timestamp(6),
        source varchar(255),
        status varchar(255) check (status in ('ACTIVE','EXPIRED','REMOVED')),
        title varchar(255) not null,
        updated_at timestamp(6),
        working_hours_type varchar(255),
        category_id bigint,
        primary key (id)
    )
2025-08-27 21:39:00.995 [main] DEBUG org.hibernate.SQL - 
    create table job_skills (
        job_id bigint not null,
        skill_id bigint not null,
        primary key (job_id, skill_id)
    )
2025-08-27 21:39:00.995 [main] DEBUG org.hibernate.SQL - 
    create table saved_jobs (
        user_id bigint not null,
        job_id bigint not null,
        primary key (user_id, job_id)
    )
2025-08-27 21:39:00.996 [main] DEBUG org.hibernate.SQL - 
    create table skills (
        id bigint generated by default as identity,
        created_at timestamp(6),
        description varchar(1000),
        external_id varchar(255),
        is_active boolean,
        last_sync_at timestamp(6),
        legacy_ams_taxonomy_id varchar(255),
        name varchar(255) not null,
        skill_level varchar(255) check (skill_level in ('BEGINNER','INTERMEDIATE','ADVANCED','EXPERT')),
        taxonomy_type varchar(255) check (taxonomy_type in ('SKILL','COMPETENCE','LANGUAGE','CERTIFICATION','EDUCATION','EXPERIENCE')),
        updated_at timestamp(6),
        primary key (id)
    )
2025-08-27 21:39:00.997 [main] DEBUG org.hibernate.SQL - 
    create table sync_checkpoints (
        id bigint generated by default as identity,
        created_at timestamp(6) not null,
        last_cursor varchar(1000),
        last_error_message varchar(2000),
        last_sync_at timestamp(6) not null,
        next_retry_at timestamp(6),
        retry_count integer,
        status varchar(255) not null check (status in ('ACTIVE','FAILED','RETRY_PENDING','SUSPENDED','COMPLETED')),
        sync_type varchar(255) not null check (sync_type in ('SNAPSHOT','INCREMENTAL','CATEGORIES','SKILLS','JOBS')),
        total_failed bigint,
        total_processed bigint,
        total_successful bigint,
        updated_at timestamp(6) not null,
        primary key (id)
    )
2025-08-27 21:39:00.998 [main] DEBUG org.hibernate.SQL - 
    create table user_profiles (
        id bigint generated by default as identity,
        account_type varchar(255),
        bio varchar(1000),
        company_name varchar(255),
        created_at timestamp(6),
        display_name varchar(255),
        location varchar(255),
        updated_at timestamp(6),
        user_id varchar(255) not null,
        primary key (id)
    )
2025-08-27 21:39:00.998 [main] DEBUG org.hibernate.SQL - 
    create table user_skills (
        user_id bigint not null,
        skill_id bigint not null,
        primary key (user_id, skill_id)
    )
2025-08-27 21:39:00.999 [main] DEBUG org.hibernate.SQL - 
    alter table if exists job_listings 
       drop constraint if exists UK_m6lrw9811gp87w19fj1108vn2
2025-08-27 21:39:00.999 [main] DEBUG org.hibernate.SQL - 
    alter table if exists job_listings 
       add constraint UK_m6lrw9811gp87w19fj1108vn2 unique (external_id)
2025-08-27 21:39:01.000 [main] DEBUG org.hibernate.SQL - 
    alter table if exists skills 
       drop constraint if exists UK_85woe63nu9klkk9fa73vf0jd0
2025-08-27 21:39:01.000 [main] DEBUG org.hibernate.SQL - 
    alter table if exists skills 
       add constraint UK_85woe63nu9klkk9fa73vf0jd0 unique (name)
2025-08-27 21:39:01.000 [main] DEBUG org.hibernate.SQL - 
    alter table if exists sync_checkpoints 
       drop constraint if exists UK_ilo0xhgrnmuke3ohiiwnqolf5
2025-08-27 21:39:01.000 [main] DEBUG org.hibernate.SQL - 
    alter table if exists sync_checkpoints 
       add constraint UK_ilo0xhgrnmuke3ohiiwnqolf5 unique (sync_type)
2025-08-27 21:39:01.001 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists UK_e5h89rk3ijvdmaiig4srogdc6
2025-08-27 21:39:01.001 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       add constraint UK_e5h89rk3ijvdmaiig4srogdc6 unique (user_id)
2025-08-27 21:39:01.002 [main] DEBUG org.hibernate.SQL - 
    alter table if exists job_categories 
       add constraint FK26xw2sib4cyebfsglum0b3t89 
       foreign key (parent_id) 
       references job_categories
2025-08-27 21:39:01.004 [main] DEBUG org.hibernate.SQL - 
    alter table if exists job_listings 
       add constraint FKdpygsn24g1454eodncrd72p0u 
       foreign key (category_id) 
       references job_categories
2025-08-27 21:39:01.004 [main] DEBUG org.hibernate.SQL - 
    alter table if exists job_skills 
       add constraint FKe10ho7um0atjm67b9dgokmfyx 
       foreign key (skill_id) 
       references skills
2025-08-27 21:39:01.005 [main] DEBUG org.hibernate.SQL - 
    alter table if exists job_skills 
       add constraint FKf628u8q1dd9nsdb1ga253i018 
       foreign key (job_id) 
       references job_listings
2025-08-27 21:39:01.006 [main] DEBUG org.hibernate.SQL - 
    alter table if exists saved_jobs 
       add constraint FK7gutrd948rupn45fydjjva2y0 
       foreign key (job_id) 
       references job_listings
2025-08-27 21:39:01.007 [main] DEBUG org.hibernate.SQL - 
    alter table if exists saved_jobs 
       add constraint FK2704138vexb7kuka0ycmi5q5c 
       foreign key (user_id) 
       references user_profiles
2025-08-27 21:39:01.007 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_skills 
       add constraint FKh223y61gwijpgqt6nlsuti07g 
       foreign key (skill_id) 
       references skills
2025-08-27 21:39:01.007 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_skills 
       add constraint FKdxvapgo2wmjrp52po6yxfytk9 
       foreign key (user_id) 
       references user_profiles
2025-08-27 21:39:01.008 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-08-27 21:39:01.202 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-08-27 21:39:01.998 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-08-27 21:39:02.167 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
2025-08-27 21:39:02.465 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8081"]
2025-08-27 21:39:02.478 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8081 (http) with context path '/api'
2025-08-27 21:39:02.487 [main] INFO  s.s.b.StegrooBackendApplication - Started StegrooBackendApplication in 3.31 seconds (process running for 3.462)
2025-08-27 21:39:02.492 [scheduling-1] DEBUG s.s.b.service.DeadLetterQueueService - Kontrollerar jobb som är redo för retry
2025-08-27 21:39:02.539 [scheduling-1] DEBUG org.hibernate.SQL - 
    select
        dlq1_0.id,
        dlq1_0.created_at,
        dlq1_0.error_message,
        dlq1_0.error_type,
        dlq1_0.external_id,
        dlq1_0.failure_reason,
        dlq1_0.job_data,
        dlq1_0.max_retries,
        dlq1_0.next_retry_at,
        dlq1_0.retry_count,
        dlq1_0.stack_trace,
        dlq1_0.status,
        dlq1_0.sync_type,
        dlq1_0.updated_at 
    from
        dead_letter_queue dlq1_0 
    where
        dlq1_0.status='PENDING' 
        and dlq1_0.next_retry_at<=?
2025-08-27 21:39:02.544 [scheduling-1] DEBUG s.s.b.service.SyncCheckpointService - Kontrollerar checkpoints som behöver retry
2025-08-27 21:39:02.550 [scheduling-1] DEBUG org.hibernate.SQL - 
    select
        sc1_0.id,
        sc1_0.created_at,
        sc1_0.last_cursor,
        sc1_0.last_error_message,
        sc1_0.last_sync_at,
        sc1_0.next_retry_at,
        sc1_0.retry_count,
        sc1_0.status,
        sc1_0.sync_type,
        sc1_0.total_failed,
        sc1_0.total_processed,
        sc1_0.total_successful,
        sc1_0.updated_at 
    from
        sync_checkpoints sc1_0 
    where
        sc1_0.status=? 
        and sc1_0.next_retry_at<?
2025-08-27 21:44:02.546 [scheduling-1] DEBUG s.s.b.service.DeadLetterQueueService - Kontrollerar jobb som är redo för retry
2025-08-27 21:44:02.549 [scheduling-1] DEBUG org.hibernate.SQL - 
    select
        dlq1_0.id,
        dlq1_0.created_at,
        dlq1_0.error_message,
        dlq1_0.error_type,
        dlq1_0.external_id,
        dlq1_0.failure_reason,
        dlq1_0.job_data,
        dlq1_0.max_retries,
        dlq1_0.next_retry_at,
        dlq1_0.retry_count,
        dlq1_0.stack_trace,
        dlq1_0.status,
        dlq1_0.sync_type,
        dlq1_0.updated_at 
    from
        dead_letter_queue dlq1_0 
    where
        dlq1_0.status='PENDING' 
        and dlq1_0.next_retry_at<=?
2025-08-27 21:44:21.653 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-08-27 21:44:21.654 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-08-27 21:44:21.656 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
